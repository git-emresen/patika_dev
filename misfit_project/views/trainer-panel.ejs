<!DOCTYPE html>
<html lang="en">

<head>
   <!-- basic -->
   <meta charset="utf-8">
   <meta http-equiv="X-UA-Compatible" content="IE=edge">
   <!-- mobile metas -->
   <meta name="viewport" content="width=device-width, initial-scale=1">
   <meta name="viewport" content="initial-scale=1, maximum-scale=1">
   <!-- site metas -->
   <title>Trainer Dashboard - misfit</title>
   <meta name="keywords" content="">
   <meta name="description" content="">
   <meta name="author" content="">
   <!-- bootstrap css -->
   <link rel="stylesheet" href="../public/css/bootstrap.min.css">
   <!-- style css -->
   <link rel="stylesheet" href="../public/css/style.css">
   <!-- Responsive-->
   <link rel="stylesheet" href="../public/css/responsive.css">
   <!-- fevicon -->
   <link rel="icon" href="../public/images/fevicon.png" type="image/gif" />
   <!-- Scrollbar Custom CSS -->
   <link rel="stylesheet" href="../public/css/jquery.mCustomScrollbar.min.css">
   <!-- Tweaks for older IEs-->
   <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.0.3/css/font-awesome.css">
   <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/fancybox/2.1.5/jquery.fancybox.min.css"
      media="screen">
   <link rel="stylesheet" href="https://rawgit.com/LeshikJanz/libraries/master/Bootstrap/baguetteBox.min.css">
   <style>
      .trainer-header {
         background: linear-gradient(135deg, #ff6600 0%, #ff8533 100%);
         color: white;
         padding: 30px 0;
         margin-bottom: 30px;
      }

      .trainer-header h1 {
         margin: 0;
         font-size: 32px;
      }

      .card {
         border: none;
         border-radius: 8px;
         transition: transform 0.3s ease, box-shadow 0.3s ease;
         margin-bottom: 20px;
      }

      .card:hover {
         transform: translateY(-5px);
         box-shadow: 0 10px 20px rgba(0, 0, 0, 0.15);
      }

      .card-header {
         background-color: #ff6600;
         color: white;
         font-weight: bold;
      }

      .card-title {
         color: #333;
         font-weight: bold;
         margin-bottom: 10px;
      }

      .btn-primary {
         background-color: #ff6600;
         border-color: #ff6600;
      }

      .btn-primary:hover {
         background-color: #e55a00;
         border-color: #e55a00;
      }

      .btn-info {
         background-color: #17a2b8;
         border-color: #17a2b8;
      }

      .btn-block {
         display: block;
         width: 100%;
      }

      .alert {
         border-radius: 5px;
         padding: 15px;
         margin-bottom: 20px;
      }

      .training-card {
         border-left: 5px solid #ff6600;
      }

      .badge {
         font-size: 11px;
         padding: 5px 10px;
      }

      .form-group label {
         font-weight: bold;
         color: #333;
      }

      .exercise-item {
         background-color: #f9f9f9;
         border: 1px solid #ddd;
      }
   </style>
   <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script><![endif]-->
</head>

<body class="main-layout">
   <!-- loader -->
   <div class="loader_bg">
      <div class="loader"><img src="../public/images/loading.gif" alt="#" /></div>
   </div>
   <!-- end loader -->

   <!-- header -->
   <header>
      <div class="header">
         <div class="container">
            <div class="row">
               <div class="col-xl-3 col-lg-3 col-md-3 col-sm-3 col logo_section">
                  <div class="full">
                     <div class="center-desk">
                        <div class="logo">
                           <a href="/index"><img src="../public/images/logo.png" alt="#" /></a>
                        </div>
                     </div>
                  </div>
               </div>
               <div class="col-xl-9 col-lg-9 col-md-9 col-sm-9">
                  <nav class="navigation navbar navbar-expand-md navbar-dark">
                     <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarsExample04"
                        aria-controls="navbarsExample04" aria-expanded="false" aria-label="Toggle navigation">
                        <span class="navbar-toggler-icon"></span>
                     </button>
                     <div class="collapse navbar-collapse" id="navbarsExample04">
                        <ul class="navbar-nav mr-auto">
                           <li class="nav-item">
                              <a class="nav-link" href="/index">Home</a>
                           </li>
                           <li class="nav-item">
                              <a class="nav-link" href="/about">About</a>
                           </li>
                           <li class="nav-item">
                              <a class="nav-link" href="/trainer">Trainer</a>
                           </li>
                           <li class="nav-item">
                              <a class="nav-link" href="/gallery">Gallery</a>
                           </li>
                           <li class="nav-item">
                              <a class="nav-link" href="/contact">Contact Us</a>
                           </li>
                           <li class="nav-item">
                              <a class="nav-link" href="/panel/trainer">Dashboard</a>
                           </li>
                           <li class="nav-item">
                              <a class="nav-link" href="/auth/logout">LOGOUT</a>
                           </li>
                        </ul>
                     </div>
                  </nav>
               </div>
            </div>
         </div>
      </div>
   </header>
   <!-- end header -->

   <!-- Trainer Header -->
   <div class="trainer-header">
      <div class="container">
         <div class="row">
            <div class="col-md-12">
               <h1>üèãÔ∏è Trainer Dashboard</h1>
               <p>Welcome, <%= user.name %>! Manage your training courses.</p>
            </div>
         </div>
      </div>
   </div>

   <!-- Main Content -->
   <div class="container mt-5 mb-5">
      <!-- Alerts -->
      <% if(typeof message !== 'undefined' && message) { %>
      <div class="row">
         <div class="col-md-12">
            <div class="alert alert-success alert-dismissible fade show" role="alert">
               <strong>Success!</strong> <%= message %>
               <button type="button" class="close" data-dismiss="alert" aria-label="Close">
                  <span aria-hidden="true">&times;</span>
               </button>
            </div>
         </div>
      </div>
      <% } %>

      <% if(typeof error !== 'undefined' && error) { %>
      <div class="row">
         <div class="col-md-12">
            <div class="alert alert-danger alert-dismissible fade show" role="alert">
               <strong>Error!</strong> <%= error %>
               <button type="button" class="close" data-dismiss="alert" aria-label="Close">
                  <span aria-hidden="true">&times;</span>
               </button>
            </div>
         </div>
      </div>
      <% } %>

      <!-- Create Course Form -->
      <div class="row mb-5">
         <div class="col-md-12">
            <div class="card">
               <div class="card-header">
                  <h4 class="mb-0"><i class="fa fa-plus-circle"></i> Create New Training Course</h4>
               </div>
               <div class="card-body">
                  <form action="/training/create-panel" method="POST" id="createTrainingForm">
                     <div class="form-row">
                        <div class="form-group col-md-6">
                           <label for="title">Course Title</label>
                           <input type="text" class="form-control" id="title" name="title" required
                              placeholder="e.g., Advanced Cardio Training">
                        </div>
                        <div class="form-group col-md-3">
                           <label for="difficulty">Difficulty Level</label>
                           <select class="form-control" id="difficulty" name="difficulty" required>
                              <option value="">Select Difficulty</option>
                              <option value="Beginner">Beginner</option>
                              <option value="Intermediate">Intermediate</option>
                              <option value="Advanced">Advanced</option>
                           </select>
                        </div>
                        <div class="form-group col-md-3">
                           <label for="duration">Duration (minutes)</label>
                           <input type="number" class="form-control" id="duration" name="duration" required min="1"
                              placeholder="45">
                        </div>
                     </div>

                     <div class="form-group">
                        <label for="description">Course Description</label>
                        <textarea class="form-control" id="description" name="description" rows="3" required
                           placeholder="Describe your training course..."></textarea>
                     </div>

                     <div class="form-group">
                        <label>Exercises</label>
                        <div id="exercisesContainer">
                           <div class="exercise-item p-3 mb-2 rounded">
                              <div class="row">
                                 <div class="col-md-4">
                                    <input type="text" class="form-control exercise-name" placeholder="Exercise name"
                                       required>
                                 </div>
                                 <div class="col-md-2">
                                    <input type="number" class="form-control exercise-sets" placeholder="Sets" min="1"
                                       required>
                                 </div>
                                 <div class="col-md-2">
                                    <input type="number" class="form-control exercise-reps" placeholder="Reps" min="1"
                                       required>
                                 </div>
                                 <div class="col-md-4">
                                    <button type="button" class="btn btn-sm btn-danger btn-remove-exercise">
                                       <i class="fa fa-trash"></i> Remove
                                    </button>
                                 </div>
                              </div>
                           </div>
                        </div>
                        <button type="button" class="btn btn-sm btn-secondary" id="addExerciseBtn">
                           <i class="fa fa-plus"></i> Add Exercise
                        </button>
                     </div>

                     <button type="submit" class="btn btn-primary btn-block">
                        <i class="fa fa-save"></i> Create Training Course
                     </button>
                  </form>
               </div>
            </div>
         </div>
      </div>

      <!-- My Training Courses -->
      <div class="row">
         <div class="col-md-12">
            <h2 class="mb-4"><i class="fa fa-list"></i> My Training Courses</h2>
         </div>
      </div>

      <% if(trainerTrainings && trainerTrainings.length > 0) { %>
      <div class="row">
         <% trainerTrainings.forEach(training => { %>
         <div class="col-md-6 mb-4">
            <div class="card training-card h-100">
               <div class="card-body">
                  <h5 class="card-title"><%= training.title %></h5>
                  <p class="card-text"><%= training.description %></p>

                  <div class="mb-3">
                     <p class="mb-2">
                        <strong>Difficulty:</strong>
                        <span
                           class="badge badge-<%= training.difficulty === 'Beginner' ? 'success' : training.difficulty === 'Intermediate' ? 'warning' : 'danger' %>">
                           <%= training.difficulty %>
                        </span>
                     </p>
                     <p class="mb-2">
                        <strong>Duration:</strong> <%= training.duration %> minutes
                     </p>
                     <p class="mb-2">
                        <strong>Enrolled Members:</strong> <span class="badge badge-info"><%= training.enrolledCount || 0
                           %></span>
                     </p>
                     <p class="mb-2">
                        <strong>Exercises:</strong> <%= training.exercises.length %>
                     </p>
                  </div>

                  <div class="mb-3">
                     <p><strong>Exercises:</strong></p>
                     <ul class="small" style="max-height: 120px; overflow-y: auto;">
                        <% training.exercises.forEach(exercise => { %>
                        <li><%= exercise.name %> - <%= exercise.sets %> sets x <%= exercise.reps %> reps</li>
                        <% }); %>
                     </ul>
                  </div>

                  <div class="btn-group btn-block" role="group">
                     <button type="button" class="btn btn-sm btn-info btn-view-enrolled"
                        data-training-id="<%= training._id %>">
                        <i class="fa fa-users"></i> View Members
                     </button>
                     <button type="button" class="btn btn-sm btn-warning btn-edit-training"
                        data-training-id="<%= training._id %>">
                        <i class="fa fa-edit"></i> Edit
                     </button>
                     <form action="/training/delete-training" method="POST" style="display: inline;">
                        <input type="hidden" name="trainingId" value="<%= training._id %>">
                        <button type="submit" class="btn btn-sm btn-danger"
                           onclick="return confirm('Are you sure you want to delete this course?')">
                           <i class="fa fa-trash"></i> Delete
                        </button>
                     </form>
                  </div>
               </div>
            </div>
         </div>
         <% }); %>
      </div>
      <% } else { %>
      <div class="row">
         <div class="col-md-12">
            <div class="alert alert-info" role="alert">
               <i class="fa fa-info-circle"></i> You haven't created any training courses yet. Create your first course
               using the form above!
            </div>
         </div>
      </div>
      <% } %>
   </div>

   <!-- Enrolled Members Modal -->
   <div class="modal fade" id="enrolledMembersModal" tabindex="-1" role="dialog"
      aria-labelledby="enrolledModalLabel" aria-hidden="true">
      <div class="modal-dialog modal-lg" role="document">
         <div class="modal-content">
            <div class="modal-header" style="background-color: #ff6600; color: white;">
               <h5 class="modal-title" id="enrolledModalLabel">Enrolled Members</h5>
               <button type="button" class="close" data-dismiss="modal" aria-label="Close" style="color: white;">
                  <span aria-hidden="true">&times;</span>
               </button>
            </div>
            <div class="modal-body" id="enrolledMembersBody">
               <p>Loading...</p>
            </div>
            <div class="modal-footer">
               <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
            </div>
         </div>
      </div>
   </div>

   <!-- footer -->
   <footer>
      <div class="footer">
         <div class="container">
            <div class="row">
               <div class="col-md-3">
                  <h3>Link Menu</h3>
                  <ul class="link_menu">
                     <li><a href="/index">Home</a></li>
                     <li><a href="/about">About</a></li>
                     <li><a href="/trainer">Trainer</a></li>
                     <li><a href="/gallery">Gallery</a></li>
                     <li><a href="/contact">Contact Us</a></li>
                  </ul>
               </div>
               <div class="col-md-5">
                  <h3>Contact US</h3>
                  <ul class="conta">
                     <li><i class="fa fa-map-marker" aria-hidden="true"></i>Address: Lorem Ipsum is simply dummy</li>
                     <li><i class="fa fa-mobile" aria-hidden="true"></i> Phone: +(1234) 567 890</li>
                     <li><i class="fa fa-envelope" aria-hidden="true"></i><a href="#">Email: demo@gmail.com</a></li>
                  </ul>
               </div>
               <div class="col-md-4">
                  <h3>Newsletter</h3>
                  <form class="bottom_form">
                     <input class="enter" placeholder="Enter your email" type="text" name="email">
                     <button class="sub_btn">Subscribe</button>
                  </form>
               </div>
            </div>
         </div>
         <div class="copyright">
            <div class="container">
               <div class="row">
                  <div class="col-md-10 offset-md-1">
                     <p>¬© 2025 All Rights Reserved. Design by <a href="https://html.design/">Free Html Templates</a>
                     </p>
                  </div>
               </div>
            </div>
         </div>
      </div>
   </footer>
   <!-- end footer -->

   <!-- Javascript files -->
   <script src="../public/js/jquery.min.js"></script>
   <script src="../public/js/bootstrap.bundle.min.js"></script>
   <script src="../public/js/jquery-3.0.0.min.js"></script>
   <script src="../public/js/jquery.mCustomScrollbar.concat.min.js"></script>
   <script src="../public/js/custom.js"></script>
   <script src="https://cdnjs.cloudflare.com/ajax/libs/baguettebox.js/1.8.1/baguetteBox.min.js"></script>

   <script>
      baguetteBox.run('.tz-gallery');

      // Add Exercise Button
      document.getElementById('addExerciseBtn').addEventListener('click', function() {
         const container = document.getElementById('exercisesContainer');
         const newExercise = document.createElement('div');
         newExercise.className = 'exercise-item p-3 mb-2 rounded';
         newExercise.innerHTML = `
            <div class="row">
               <div class="col-md-4">
                  <input type="text" class="form-control exercise-name" placeholder="Exercise name" required>
               </div>
               <div class="col-md-2">
                  <input type="number" class="form-control exercise-sets" placeholder="Sets" min="1" required>
               </div>
               <div class="col-md-2">
                  <input type="number" class="form-control exercise-reps" placeholder="Reps" min="1" required>
               </div>
               <div class="col-md-4">
                  <button type="button" class="btn btn-sm btn-danger btn-remove-exercise">
                     <i class="fa fa-trash"></i> Remove
                  </button>
               </div>
            </div>
         `;
         container.appendChild(newExercise);
         attachRemoveListener(newExercise.querySelector('.btn-remove-exercise'));
      });

      // Remove Exercise
      function attachRemoveListener(btn) {
         btn.addEventListener('click', function() {
            this.closest('.exercise-item').remove();
         });
      }

      document.querySelectorAll('.btn-remove-exercise').forEach(btn => {
         attachRemoveListener(btn);
      });

      // Form Submission - Exercises Array
      document.getElementById('createTrainingForm').addEventListener('submit', function(e) {
         const exercises = [];
         document.querySelectorAll('.exercise-item').forEach(item => {
            const name = item.querySelector('.exercise-name').value;
            const sets = item.querySelector('.exercise-sets').value;
            const reps = item.querySelector('.exercise-reps').value;
            if (name && sets && reps) {
               exercises.push({ name, sets: parseInt(sets), reps: parseInt(reps) });
            }
         });
         const exercisesInput = document.createElement('input');
         exercisesInput.type = 'hidden';
         exercisesInput.name = 'exercises';
         exercisesInput.value = JSON.stringify(exercises);
         this.appendChild(exercisesInput);
      });

      // View Enrolled Members
      document.querySelectorAll('.btn-view-enrolled').forEach(btn => {
         btn.addEventListener('click', function() {
            const trainingId = this.getAttribute('data-training-id');
            fetch('/training/enrolled-users/' + trainingId)
               .then(response => response.json())
               .then(data => {
                  let html = '<table class="table table-striped">';
                  html += '<thead><tr><th>Username</th><th>Email</th><th>Joined Date</th></tr></thead>';
                  html += '<tbody>';
                  if (data.data && data.data.length > 0) {
                     data.data.forEach(enrollment => {
                        const joinedDate = new Date(enrollment.assignedAt).toLocaleDateString();
                        html += `<tr><td>${enrollment.userId.username}</td><td>${enrollment.userId.email}</td><td>${joinedDate}</td></tr>`;
                     });
                  } else {
                     html += '<tr><td colspan="3" class="text-center">No members enrolled yet</td></tr>';
                  }
                  html += '</tbody></table>';
                  document.getElementById('enrolledMembersBody').innerHTML = html;
                  $('#enrolledMembersModal').modal('show');
               })
               .catch(error => {
                  console.error('Error:', error);
                  document.getElementById('enrolledMembersBody').innerHTML = '<p class="text-danger">Error loading members</p>';
               });
         });
      });
   </script>
</body>

</html>
